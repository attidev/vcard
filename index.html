<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vCard QR ì½”ë“œ ìƒì„±ê¸°</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“‡ vCard QR ì½”ë“œ ìƒì„±ê¸°</h1>
            <p>CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì—¬ëŸ¬ ëª…ì˜ QR ì½”ë“œë¥¼ í•œ ë²ˆì— ìƒì„±í•˜ì„¸ìš”</p>
        </header>

        <div class="upload-section">
            <div class="upload-box" id="uploadBox">
                <input type="file" id="csvFile" accept=".csv" style="display: none;">
                <label for="csvFile" class="upload-label">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span>CSV íŒŒì¼ ì„ íƒ</span>
                    <small>ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­</small>
                </label>
            </div>
            <div class="template-link">
                <a href="template.csv" download>ğŸ“¥ CSV í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</a>
            </div>
        </div>

        <div class="settings-section" id="settingsSection" style="display: none;">
            <h2>ê³µí†µ ì„¤ì •</h2>
            <div class="form-group">
                <label for="companyName">íšŒì‚¬ëª… *</label>
                <input type="text" id="companyName" placeholder="ì˜ˆ: (ì£¼)ABCíšŒì‚¬" value="NAMYANG INTL CO.,LTD">
            </div>
            <div class="form-group">
                <label for="companyAddress">íšŒì‚¬ ì£¼ì†Œ</label>
                <input type="text" id="companyAddress" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123" value="RM #701,Youngchang Digital Tower 63,Ttukseom-ro 1-gil, Seongdong-gu, Seoul, Republic of Korea">
            </div>
            <div class="form-group">
                <label for="companyWebsite">íšŒì‚¬ ì›¹ì‚¬ì´íŠ¸</label>
                <input type="text" id="companyWebsite" placeholder="ì˜ˆ: https://www.company.com" value="http://www.namyang-intl.com">
            </div>
            <button id="generateBtn" class="btn btn-primary">QR ì½”ë“œ ìƒì„±</button>
        </div>

        <div class="preview-section" id="previewSection" style="display: none;">
            <div class="preview-header">
                <h2>ìƒì„±ëœ QR ì½”ë“œ</h2>
                <div class="preview-actions">
                    <button id="downloadAllBtn" class="btn btn-secondary">ì „ì²´ ë‹¤ìš´ë¡œë“œ (ZIP)</button>
                    <button id="resetBtn" class="btn btn-outline">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
            <div class="qr-grid" id="qrGrid"></div>
        </div>
    </div>

    <!-- ë¡œì»¬ íŒŒì¼ ìš°ì„ , ì—†ìœ¼ë©´ CDN ì‚¬ìš© -->
    <script src="qrcode.min.js" onerror="loadQRCodeFromCDN()"></script>
    <script src="jszip.min.js" onerror="loadJSZipFromCDN()"></script>
    
    <script>
        // ë¡œì»¬ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨ ì‹œ CDNì—ì„œ ë¡œë“œ
        const qrcodeCDNs = [
            'https://cdn.jsdelivr.net/npm/qrcode@1.2.2/build/qrcode.min.js',
            'https://unpkg.com/qrcode@1.2.2/build/qrcode.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.2.2/qrcode.min.js',
            'https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js'
        ];
        
        const jszipCDNs = [
            'https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js',
            'https://unpkg.com/jszip@3.10.1/dist/jszip.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js'
        ];
        
        let qrcodeCDNIndex = 0;
        let jszipCDNIndex = 0;
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    setTimeout(() => resolve(), 100);
                };
                script.onerror = () => reject();
                document.head.appendChild(script);
            });
        }
        
        async function loadQRCodeFromCDN() {
            if (typeof QRCode !== 'undefined') return;
            
            for (let i = 0; i < qrcodeCDNs.length; i++) {
                try {
                    await loadScript(qrcodeCDNs[i]);
                    if (typeof QRCode !== 'undefined') {
                        console.log('âœ… QRCode ë¡œë“œ ì„±ê³µ:', qrcodeCDNs[i]);
                        return;
                    }
                } catch (e) {
                    console.warn('QRCode ë¡œë“œ ì‹¤íŒ¨:', qrcodeCDNs[i]);
                }
            }
            showLibraryError('QRCode');
        }
        
        async function loadJSZipFromCDN() {
            if (typeof JSZip !== 'undefined') return;
            
            for (let i = 0; i < jszipCDNs.length; i++) {
                try {
                    await loadScript(jszipCDNs[i]);
                    if (typeof JSZip !== 'undefined') {
                        console.log('âœ… JSZip ë¡œë“œ ì„±ê³µ:', jszipCDNs[i]);
                        return;
                    }
                } catch (e) {
                    console.warn('JSZip ë¡œë“œ ì‹¤íŒ¨:', jszipCDNs[i]);
                }
            }
            showLibraryError('JSZip');
        }
        
        function showLibraryError(libName) {
            const errorMsg = document.createElement('div');
            errorMsg.className = 'error';
            errorMsg.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10000; max-width: 700px; padding: 25px; text-align: center; line-height: 1.8;';
            let msg = `âš ï¸ ${libName} ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨\n\n`;
            msg += 'í•´ê²° ë°©ë²•:\n';
            msg += '1. ë‹¤ìŒ ë§í¬ì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”:\n';
            if (libName === 'QRCode') {
                msg += '   https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js\n';
                msg += '   íŒŒì¼ëª…: qrcode.min.js\n';
            } else {
                msg += '   https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js\n';
                msg += '   íŒŒì¼ëª…: jszip.min.js\n';
            }
            msg += '\n2. ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ì„ ì´ HTML íŒŒì¼ê³¼ ê°™ì€ í´ë”ì— ì €ì¥í•˜ì„¸ìš”.\n';
            msg += '\n3. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.';
            errorMsg.innerHTML = msg.replace(/\n/g, '<br>');
            document.body.appendChild(errorMsg);
        }
        
        // í˜ì´ì§€ ë¡œë“œ í›„ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof QRCode === 'undefined') {
                    loadQRCodeFromCDN();
                }
                if (typeof JSZip === 'undefined') {
                    loadJSZipFromCDN();
                }
                
                // ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ëª¨ë‘ ë¡œë“œë˜ë©´ app.js ë¡œë“œ
                if (typeof QRCode !== 'undefined' && typeof JSZip !== 'undefined') {
                    const appScript = document.createElement('script');
                    appScript.src = 'app.js';
                    document.body.appendChild(appScript);
                }
            }, 500);
        });
    </script>
</body>
</html>
